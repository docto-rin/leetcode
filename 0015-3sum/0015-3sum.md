# 15. 3Sum

- URL: https://leetcode.com/problems/3sum/
- Difficulty: Medium
- Tags: Array, Two Pointers, Sorting
- Notebook: https://share.solve.it.com/d/c560acdd7314a91fab380075345bc406

## Step 1

### å®Ÿè£…1

- ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®é¸æŠ
  - å…¨æ¢ç´¢ã ã¨O(n^3)ã€‚Hashmapã‚’ä½¿ã†ã“ã¨ã§O(n^2)ã¯ã§ããã†ã€‚
  - é‡è¤‡ãªãæ•°ãˆä¸Šã’ã‚‹ã®ãŒé›£ã—ãã€ãƒŠã‚¤ãƒ¼ãƒ–ã«ã¯set()ã«é‡è¤‡ã‚‚è¨±ã—ã¦è©°ã‚ã¦ã„ãã€æœ€å¾Œã«listã«ã—ã¦returnã€‚
  - ã“ã‚Œä»¥ä¸Šè‰¯ã„æ–¹æ³•ã¯æ€ã„ã¤ã‹ãªã„ã€‚
- å®Ÿè£…
  - ç­‰å·æˆç«‹ã®å€‹æ•°ã«ã‚ˆã£ã¦å ´åˆåˆ†ã‘ã™ã‚‹ã€‚
- è¨ˆç®—é‡
  - Time: O(n^2)
  - Extra Space: O(n)
  - Output Space: O(n^2)

```python
import collections
import itertools


class Solution:
    def threeSum(self, nums: list[int]) -> list[list[int]]:
        result = set()
        num_to_count = collections.Counter(nums)

        # num1 != num2, num1 != num3, and num2 != num3
        for num1, num2 in itertools.combinations(num_to_count.keys(), 2):
            num3 = -(num1 + num2)
            if num1 == num3 or num2 == num3:
                continue
            if num3 in num_to_count:
                result.add(tuple(sorted([num1, num2, num3])))
        
        # num1 == num2, num1 != num3
        for num in num_to_count.keys():
            if num_to_count[num] < 2:
                continue
            num3 = -num * 2
            if num == num3:
                continue
            if num3 in num_to_count.keys():
                result.add(tuple(sorted([num, num, num3])))
        
        # num1 == num2 == num3
        if num_to_count.get(0, 0) >= 3:
            result.add((0, 0, 0))
        
        return list(result)
```

- æŒ¯ã‚Šè¿”ã‚Š
  - æ€è€ƒã‚‚ã‚³ãƒ¼ãƒ‰ã‚‚ã”ã¡ã‚ƒã”ã¡ã‚ƒã—ã¦ã„ã‚‹ã€‚
  - ã©ã†ã›æ™‚é–“è¨ˆç®—é‡ã¯O(n^2)ãªã®ã§ã€num_to_count.keys()ã¯æœ€åˆã«ã‚½ãƒ¼ãƒˆã—ãŸæ–¹ãŒè¨ˆç®—é‡ã§å¾—ã§ã‚ã‚Šã€è¦‹é€šã—ã‚‚è‰¯ã‹ã£ãŸã€‚

## Step 2

ğŸ™‹**Q:** Step 1ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã€æ”¹å–„ç‚¹ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚


ğŸ¤–**A:**
ã‚³ãƒ¼ãƒ‰ã‚’æ‹è¦‹ã—ã¾ã—ãŸã€‚ãƒ­ã‚¸ãƒƒã‚¯ã¯æ­£ã—ãå‹•ä½œã—ã¦ã„ã¾ã™ã—ã€è¨ˆç®—é‡ã®åˆ†æã‚‚æ­£ç¢ºã§ã™ã­ï¼

ã”è‡ªèº«ã§ã€Œæ€è€ƒã‚‚ã‚³ãƒ¼ãƒ‰ã‚‚ã”ã¡ã‚ƒã”ã¡ã‚ƒã—ã¦ã„ã‚‹ã€ã¨æŒ¯ã‚Šè¿”ã‚‰ã‚Œã¦ã„ã¾ã™ãŒã€å…·ä½“çš„ã«ã©ã®éƒ¨åˆ†ãŒæ°—ã«ãªã£ã¦ã„ã¾ã™ã‹ï¼Ÿ

ä¸€ã¤æ°—ã¥ã„ãŸç‚¹ã‚’æŒ™ã’ã‚‹ã¨ã€3ã¤ã®ã‚±ãƒ¼ã‚¹ï¼ˆå…¨éƒ¨ç•°ãªã‚‹ã€2ã¤åŒã˜ã€3ã¤åŒã˜ï¼‰ã«åˆ†ã‘ã¦ã„ã‚‹ã¨ã“ã‚ã§ã™ãŒã€ã“ã®å ´åˆåˆ†ã‘ã‚’æ¸›ã‚‰ã™ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ãƒ’ãƒ³ãƒˆï¼šé…åˆ—ã‚’ã‚½ãƒ¼ãƒˆã—ã¦ã‹ã‚‰å‡¦ç†ã™ã‚‹ã¨ã€é‡è¤‡ã®æ‰±ã„ãŒã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã¤ã„ã¦è€ƒãˆã¦ã¿ãŸã„ã§ã™ã‹ï¼Ÿ

### å®Ÿè£…2

- ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®æ¤œè¨
  - æœ€åˆã«num_to_count.keys()ã‚’ã‚½ãƒ¼ãƒˆã—ã¦ãŠãã¨è¦‹é€šã—ãŒã‚ˆããªã‚‹ã€‚
  - å…·ä½“çš„ã«ã¯ã€num1 < num2 < num3ã®é–¢ä¿‚æ€§ã‚’æ‹…ä¿ã—ã‚„ã™ããªã‚‹ã€‚
    - unique_numsã‹ã‚‰ç‹­ç¾©æ˜‡é †ãªå…¨ã¦ã®ãƒšã‚¢num1, num2 (num1 < num2)ã‚’å›ã™ã€‚
    - ãªã®ã§num2 < num3ã ã‘ç¢ºã‹ã‚ã‚‹ã‚ˆã†ã«ã™ã‚Œã°num1 < num2 < num3ã¯ä¿è¨¼ã•ã‚Œã‚‹ã€‚
- è¨ˆç®—é‡
  - Time: O(n^2)
  - Extra Space: O(n)
  - Output Space: O(n^2)

```python
import collections
import itertools


class Solution:
    def threeSum(self, nums: list[int]) -> list[list[int]]:
        result = []
        num_to_count = collections.Counter(nums)
        unique_nums = sorted(num_to_count)

        # num1 < num2 < num3
        for num1, num2 in itertools.combinations(unique_nums, 2):
            num3 = -(num1 + num2)
            if num3 <= num2:
                continue
            if num3 in num_to_count:
                result.append([num1, num2, num3])
        
        # num1 == num2, num1 != num3
        for num in unique_nums:
            if num_to_count[num] < 2:
                continue
            num3 = -num * 2
            if num == num3:
                continue
            if num3 in num_to_count:
                result.append(sorted([num, num, num3]))
        
        # num1 == num2 == num3
        if num_to_count.get(0, 0) >= 3:
            result.append([0, 0, 0])
        
        return result
```

### å®Ÿè£…3

- ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®å†è€ƒ
  - two pointersã‚’ä½¿ã£ãŸæ–¹æ³•ã€‚
  - æœ€åˆã«æ€ã„åˆ‡ã£ã¦sortã—ã¦ãŠãã‹ã‚‰ã“ãæ€ã„ã¤ã‘ã‚‹ã€‚
  - Counter()ã‚„set()ãªã©ã®Hashmapã®æ§‹ç¯‰ãŒä¸è¦ã€‚
  - num1, num2, num3ã®ç­‰å·æˆç«‹ã®æœ‰ç„¡ã«ã‚ˆã‚‹å ´åˆåˆ†ã‘ãªã©ã‚‚ä¸è¦ã€‚
- è¨ˆç®—é‡
  - Time: O(n^2)
  - Extra Space: O(1)
  - Output Space: O(n^2)

```python
class Solution:
    def threeSum(self, nums: list[int]) -> list[list[int]]:
        sorted_nums = sorted(nums)
        result = []
        
        for i in range(len(sorted_nums) - 2):
            if i > 0 and sorted_nums[i] == sorted_nums[i - 1]:
                continue
            
            left, right = i + 1, len(sorted_nums) - 1
            target = -sorted_nums[i]
            
            while left < right:
                total = sorted_nums[left] + sorted_nums[right]
                
                if total < target:
                    left += 1
                    continue
                if total > target:
                    right -= 1
                    continue

                result.append([sorted_nums[i], sorted_nums[left], sorted_nums[right]])
                while left < right and sorted_nums[left] == sorted_nums[left + 1]:
                    left += 1
                while left < right and sorted_nums[right] == sorted_nums[right - 1]:
                    right -= 1
                left += 1
                right -= 1
        
        return result

```

- ã‚³ãƒ¡ãƒ³ãƒˆé›†ï¼šç©º
- PR
  - https://github.com/yamashita-ki/codingTest/pull/4
  - https://github.com/huyfififi/coding-challenges/pull/30
  - https://github.com/Ryotaro25/leetcode_first60/pull/74

ğŸ™‹**Q:** ä¸Šè¨˜ã«ä»–ã®äººãŒè§£ã„ãŸPRã‚’ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚ãã‚Œãã‚Œã®PRã®ä»£è¡¨çš„ãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã—ã€PRã”ã¨ã®å†…å®¹ã‚’ç°¡æ½”ã«ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚


ğŸ¤–**A:**
å„PRã®å†…å®¹ã‚’ç°¡æ½”ã«ã¾ã¨ã‚ã¾ã™ï¼š

---

**PR 1: yamashita-ki/codingTest#4** (Java)
- **è§£æ³•**: 3é‡ãƒ«ãƒ¼ãƒ—ã¨two pointersã®ä¸¡æ–¹ã‚’å®Ÿè£…
- **ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆ**:
  - ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ã®æºã‚Œï¼ˆæ¼”ç®—å­å‘¨ã‚Šã®ã‚¹ãƒšãƒ¼ã‚¹ã‚„`;`å¾Œã®ã‚¹ãƒšãƒ¼ã‚¹ï¼‰ãŒæ°—ã«ãªã‚‹
  - **ã¶ã‚‰ä¸‹ãŒã‚Šif**ï¼ˆ`if (...) break;`ã®ã‚ˆã†ã«æ³¢æ‹¬å¼§ãªã—ï¼‰ã¯äº‹æ•…ãŒèµ·ãã‚„ã™ã„ã®ã§é¿ã‘ã‚‹ã¹ã
  - `curSum`ã®`current`ã¯ä¸è¦ãªæƒ…å ± â€• å”¯ä¸€ã®sumãªã®ã§å˜ã«`sum`ã§ååˆ†

---

**PR 2: huyfififi/coding-challenges#30** (Python)
- **è§£æ³•**: Two Sumãƒ™ãƒ¼ã‚¹ã®è§£æ³•ï¼ˆstep1ã§TLEï¼‰ã€two pointersè§£æ³•ï¼ˆstep2ä»¥é™ï¼‰
- **ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆ**:
  - å¤–å´ãƒ«ãƒ¼ãƒ—ã ã‘`fixed_number`ã¨åä»˜ã‘ã¦ã„ã‚‹ã®ã¯é•å’Œæ„Ÿ
  - **`nums.sort()`ã§å…¥åŠ›ã‚’å¤‰æ›´ã—ã¦ã„ã‚‹**ã®ã¯å•é¡Œ â€• å‘¼ã³å‡ºã—å´ãŒé©šãå¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§ã€å…¥åŠ›ã¯å¤‰æ›´ã—ãªã„ã‹ã€ã‚³ãƒ¡ãƒ³ãƒˆã§æ˜è¨˜ã™ã¹ã

---

**PR 3: Ryotaro25/leetcode_first60#74** (C++)
- **è§£æ³•**: sort + two pointers
- **ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆ**:
  - `sum < 0`ã¨`sum > 0`ã®å ´åˆã¯`continue`ã—ã¦ã€`sum == 0`ã®ãƒã‚¹ãƒˆã‚’ä¸‹ã’ãŸæ–¹ãŒèª­ã¿ã‚„ã™ã„
  - `do-while`ã‚’ä½¿ã†ã¨1è¡Œæ¸›ã‚‰ã›ã‚‹ï¼ˆèª­ã¿ã‚„ã™ã•ã¯å¤‰ã‚ã‚‰ãªã„ã‹ã‚‚ï¼‰
  - **`nums`ãŒéconstå‚ç…§ã ã¨å¤‰æ›´ã•ã‚Œã‚‹ã¨æ€ã‚ã›ã¦ã—ã¾ã†** â€• å¤‰æ›´ã—ãªã„ãªã‚‰constå‚ç…§ã§æ¸¡ã™ã¹ã

---

å…±é€šã—ã¦å‚è€ƒã«ãªã‚‹ãƒã‚¤ãƒ³ãƒˆï¼š
1. å…¥åŠ›ã‚’å¤‰æ›´ã™ã‚‹å ´åˆã¯æ˜ç¤ºçš„ã«ï¼ˆ`sorted(nums)`ã‚’ä½¿ã†ãªã©ï¼‰
2. å¤‰æ•°åã¯å†—é•·ãªä¿®é£¾ã‚’é¿ã‘ã‚‹ï¼ˆ`current`ãªã©ï¼‰
3. ãƒã‚¹ãƒˆã‚’æµ…ãã™ã‚‹ãŸã‚ã«æ—©æœŸ`continue`/`return`ã‚’æ´»ç”¨

ğŸ™‹**Q:** å®Ÿè£…2ã€å®Ÿè£…3ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã€æ”¹å–„ç‚¹ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚


ğŸ¤–**A:**
ä¸¡æ–¹ã®ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚

**å®Ÿè£…2ã«ã¤ã„ã¦ï¼š**

1. **2ã¤ç›®ã®ã‚±ãƒ¼ã‚¹ã®`sorted()`ãŒç„¡é§„**
   ```python
   result.append(sorted([num, num, num3]))
   ```
   `num`ã¨`num3`ã®å¤§å°é–¢ä¿‚ã‚’è€ƒãˆã‚‹ã¨ã€`num3 = -num * 2`ãªã®ã§ï¼š
   - `num < 0` â†’ `num3 > 0` â†’ `[num, num, num3]`
   - `num > 0` â†’ `num3 < 0` â†’ `[num3, num, num]`
   
   `sorted()`ã‚’ä½¿ã‚ãšã€æ¡ä»¶åˆ†å²ã§æ›¸ã‘ã¾ã™ã€‚ãŸã ã—ã€ãã®åˆ†ã‚³ãƒ¼ãƒ‰ã¯é•·ããªã‚‹ã®ã§ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã§ã™ã­ã€‚

2. **`num_to_count.get(0, 0)`ã¨ä»–ã®ç®‡æ‰€ã®ä¸€è²«æ€§**
   ä»–ã§ã¯`num3 in num_to_count`ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã«ã€æœ€å¾Œã ã‘`.get()`ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚çµ±ä¸€ã™ã‚‹ãªã‚‰ï¼š
   ```python
   if 0 in num_to_count and num_to_count[0] >= 3:
   ```

---

**å®Ÿè£…3ã«ã¤ã„ã¦ï¼š**

1. **PRã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§å‡ºãŸã€Œå…¥åŠ›å¤‰æ›´ã€ã®è¦³ç‚¹**
   `sorted(nums)`ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§å•é¡Œãªã—ã€‚è‰¯ã„ã§ã™ã­ï¼

2. **é‡è¤‡ã‚¹ã‚­ãƒƒãƒ—ã®`while`ãƒ«ãƒ¼ãƒ—ã«æ½œåœ¨çš„ãªå•é¡Œ**
   ```python
   while left < right and sorted_nums[left] == sorted_nums[left + 1]:
       left += 1
   ```
   `left + 1`ãŒç¯„å›²å¤–ã«ãªã‚‹å¯èƒ½æ€§ã¯ï¼Ÿ â†’ `left < right`ãŒå…ˆã«è©•ä¾¡ã•ã‚Œã‚‹ã®ã§å¤§ä¸ˆå¤«ã§ã™ãŒã€`left + 1 < len(sorted_nums)`ã®æ–¹ãŒæ„å›³ãŒæ˜ç¢ºã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

3. **å¤‰æ•°å`total`ã¨`target`**
   ä¸¡æ–¹"t"ã§å§‹ã¾ã‚Šã€å½¹å‰²ãŒä¼¼ã¦ã„ã‚‹ã®ã§æ··ä¹±ã—ã‚„ã™ã„ã‹ã‚‚ã€‚`current_sum`ã¨`target`ã€ã‚ã‚‹ã„ã¯`two_sum`ã¨`target`ãªã©ã€å·®åˆ¥åŒ–ã—ã¦ã‚‚ã‚ˆã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

4. **early continueãƒ‘ã‚¿ãƒ¼ãƒ³ã®é©ç”¨ï¼ˆPRã§è¨€åŠã•ã‚Œã¦ã„ãŸç‚¹ï¼‰**
   ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ã¯ååˆ†èª­ã¿ã‚„ã™ã„ã§ã™ãŒã€ä¸€è‡´ã—ãŸå¾Œã®å‡¦ç†ã‚’é–¢æ•°ã«åˆ‡ã‚Šå‡ºã™ã¨ã•ã‚‰ã«ã‚¹ãƒƒã‚­ãƒªã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

---

å…¨ä½“ã¨ã—ã¦ã€å®Ÿè£…3ã¯ã‹ãªã‚Šç¶ºéº—ã«æ›¸ã‘ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚ç‰¹ã«æ°—ã«ãªã‚‹ç‚¹ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ

## Step 3

### å®Ÿè£…4

- [å®Ÿè£…3](#å®Ÿè£…3)ã‚’ãƒ™ãƒ¼ã‚¹ã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿
  - é‡è¤‡ã—ãŸæ•°å­—ã‚’é£›ã°ã™éƒ¨åˆ†ã‚’é–¢æ•°åŒ–ã—ã¦åˆ‡ã‚Šå‡ºã™ã€‚
  - ãƒã‚¤ãƒ³ã‚¿ã¯i, left, rightã§ã¯ãªãå˜ã«i, j, kã«ã—ãŸã€‚
    - ã©ã†ã›left, rightã¨ã—ã¦ã‚‚j, kç¨‹åº¦ã—ã‹æƒ…å ±é‡ã¯ãªã„ã€‚ï¼ˆé€²ã‚€å‘ãã¨ã‹ã¯ã‚ã‹ã‚‰ãªã„ã€‚ï¼‰
    - ãªã‚‰i, j, kã®æ–¹ãŒçµ±ä¸€æ„ŸãŒã‚ã‚‹ã€‚

```python
class Solution:
    def threeSum(self, nums: list[int]) -> list[list[int]]:
        sorted_nums = sorted(nums)
        n = len(sorted_nums)
        result = []

        def skip_to_next_different(start, step):
            index = start
            while (0 <= index + step < n
                and sorted_nums[index] == sorted_nums[index + step]):
                index += step
            return index + step
        
        i = 0
        while i < n - 2:
            j, k = i + 1, n - 1
            target = -sorted_nums[i]
            
            # two pointers
            # invariant: i < j < k (< n)
            while j < k:
                total = sorted_nums[j] + sorted_nums[k]
                
                if total < target:
                    j += 1
                    continue
                if total > target:
                    k -= 1
                    continue

                result.append([sorted_nums[i], sorted_nums[j], sorted_nums[k]])
                j = skip_to_next_different(j, 1)
                k = skip_to_next_different(k, -1)
            
            i = skip_to_next_different(i, 1)
        
        return result

```

## Step 4

è‡ªåˆ†ã®PRï¼šï¼ˆè‡ªåˆ†ã®PRã¸ã®ãƒªãƒ³ã‚¯ï¼‰

ğŸ™‹**Q:** ãã‚Œãã‚Œã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã«ã¤ã„ã¦ã€ã‚‚ã†å°‘ã—è©³ã—ãæ•™ãˆã¦ãã ã•ã„ã€‚

### å®Ÿè£…5

- ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å—ã‘ã¦æ›¸ãç›´ã—
  - ï¼ˆä¿®æ­£ç‚¹ï¼‰

```python
class Solution:
    pass
```